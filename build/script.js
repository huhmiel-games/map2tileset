(()=>{var b=document.getElementById("save-tileset"),z=document.getElementById("undo-btn"),w=document.getElementById("redo-btn"),h=document.getElementById("image"),T=document.getElementById("offset-x"),v=document.getElementById("offset-y"),f=document.getElementById("imageCanvas"),y=document.getElementById("tileset"),l=document.getElementById("tilesetCanvas"),r=document.getElementById("red-zone"),a=document.getElementById("floating-canvas"),C=document.getElementById("selected-area-label"),$=document.getElementById("image-zoom"),F=document.getElementById("tileset-zoom"),O=document.getElementById("left-panel"),g=document.getElementById("right-panel"),o={sx:0,sy:0,ex:0,ey:0,isDirty:!1,isComplete:!1,data:void 0},s={name:"",width:0,height:0,isLoaded:!1,zoom:1,offsetX:0,offsetY:0},i={name:"",width:0,height:0,isLoaded:!1,zoom:1,undos:[],redos:[]},c={tilesize:+localStorage.getItem("tilesize")||8},M,p=document.querySelector("nav").clientHeight;document.getElementById("open-image").addEventListener("change",P,!1);document.getElementById("open-tileset").addEventListener("change",Q,!1);document.getElementById("settings-btn").addEventListener("click",B,!1);document.getElementById("about-btn").addEventListener("click",B,!1);document.getElementById("new-tileset-btn").addEventListener("click",B,!1);document.addEventListener("wheel",ie,{passive:!1});document.querySelectorAll('[id ^= "close-"]').forEach(e=>e.addEventListener("click",D));document.getElementById("confirm-settings-btn").addEventListener("click",A);document.getElementById("confirm-tileset-btn").addEventListener("click",V,!1);document.addEventListener("keydown",ne);T.addEventListener("change",j,!1);v.addEventListener("change",q,!1);C.addEventListener("click",I,!1);f.addEventListener("mousedown",N,!1);f.addEventListener("mouseup",J,!1);f.addEventListener("contextmenu",I,!1);z.addEventListener("click",H,!1);w.addEventListener("click",U,!1);b.addEventListener("click",S,!1);l.addEventListener("mousemove",ee,!1);l.addEventListener("click",_,!1);l.addEventListener("contextmenu",te,!1);c.tilesize!==8&&(f.style.backgroundImage=`url("/assets/grid-${c.tilesize/8}.png")`,l.style.backgroundImage=`url("/assets/grid-${c.tilesize/8}.png")`);function B(e){e.preventDefault(),document.getElementById("tilesize").value=c.tilesize;let t=document.getElementById(e.currentTarget.getAttribute("data-target"));t.open=!0,M=t}function D(e){M=void 0,e.preventDefault(),document.getElementById("tilesize").value=c.tilesize;let t=document.getElementById(e.currentTarget.getAttribute("data-target"));t.open=!1}function A(e){e.preventDefault(),c.tilesize=+document.getElementById("tilesize").value,localStorage.setItem("tilesize",c.tilesize),D(e)}function P(e){let t=e.target.files,n=t.length;if(G(),n>0){s.name=t.name;let d=URL.createObjectURL(t[0]);h.src=d,h.addEventListener("load",u=>{s.width=h.naturalWidth,s.height=h.naturalHeight,f.classList.remove("none"),X(f,h),s.isLoaded=!0},{once:!0})}}function R(){f.getContext("2d").clearRect(0,0,f.width,f.height),X(f,h,s.offsetX,s.offsetY)}function E(){let e=f.getContext("2d");try{o.data=e.getImageData(o.sx/s.zoom,o.sy/s.zoom,(o.ex-o.sx)/s.zoom,(o.ey-o.sy)/s.zoom)}catch(n){alert("Select a zone first");return}a.classList.remove("none"),a.classList.add("floating-canvas"),a.width=o.ex-o.sx,a.height=o.ey-o.sy,a.getContext("2d").putImageData(o.data,0,0)}function j(e){s.offsetX=+e.target.value,s.isLoaded&&R()}function q(e){s.offsetY=+e.target.value,s.isLoaded&&R()}function G(){s.offsetX=0,s.offsetY=0,T.value=0,v.value=0}function N(e){s.isLoaded===!1||e.button!==0||(o.isComplete&&I(e),o.sx=m((e.offsetX-s.offsetX)/s.zoom)*s.zoom,o.sy=m((e.offsetY-s.offsetY)/s.zoom)*s.zoom,o.isDirty=!0,Z(o.sx,o.sy))}function J(e){if(o.isDirty===!1||s.isLoaded===!1||o.isComplete===!0||e.button!==0)return;let t=m((e.offsetX-o.sx)/s.zoom),n=m((e.offsetY-o.sy)/s.zoom);for(;Y(t)===!1;)t=Math.floor(t+1);for(;Y(n)===!1;)n=Math.floor(n+1);o.ex=o.sx+t*s.zoom,o.ey=o.sy+n*s.zoom,o.ex===o.sx&&(o.ex+=c.tilesize),o.ey===o.sy&&(o.ey+=c.tilesize),o.isComplete=!0,oe(o),E()}function Q(e){let t=e.target.files;if(t.length>0){i.name=t[0].name;let d=URL.createObjectURL(t[0]);y.src=d,y.addEventListener("load",u=>{i.width=y.naturalWidth,i.height=y.naturalHeight,l.classList.remove("none"),X(l,y),i.isLoaded=!0,b.disabled=!1,s.isLoaded&&o.isComplete&&E()},{once:!0})}}function V(e){let t=document.getElementById("tileset-name").value||"tileset";i.name=t+".png",i.width=+document.getElementById("tileset-width").value||512,i.height=+document.getElementById("tileset-height").value||512,l.width=i.width,l.height=i.height;let n=l.getContext("2d");n.fillStyle="rgba(0, 0, 0, 0)",n.fillRect(0,0,i.width,i.height),y.src=l.toDataURL(),l.classList.remove("none"),i.isLoaded=!0,b.disabled=!1,s.isLoaded&&o.isComplete&&E(),D(e)}function S(){let e=l.toDataURL("image/png"),t=new XMLHttpRequest;t.responseType="blob",t.onload=function(){let n=document.createElement("a");n.href=window.URL.createObjectURL(t.response),n.download=i.name,n.style.display="none",document.body.appendChild(n),n.click(),n.remove()},t.open("GET",e),t.send()}function _(e){let t=m(e.offsetX/i.zoom)-o.data.width/2,n=m(e.offsetY/i.zoom)-o.data.height/2,d=(o.ex-o.sx)/s.zoom,u=(o.ey-o.sy)/s.zoom;if(o.data){let L=l.getContext("2d"),K=L.getImageData(t,n,d,u),W=new x(K,t,n,d,u);i.undos.push(W),L.putImageData(o.data,t,n),z.disabled=!1}}function H(){let e=i.undos.at(-1);if(!e)return;let t=l.getContext("2d"),n=t.getImageData(e.x,e.y,e.width,e.height),d=new x(n,e.x,e.y,e.width,e.height);i.redos.push(d),t.clearRect(e.x,e.y,e.width,e.height),t.putImageData(e.data,e.x,e.y),i.undos.pop(),w.disabled=!1,i.undos.length===0&&(z.disabled=!0)}function U(){let e=i.redos.at(-1);if(!e)return;let t=l.getContext("2d"),n=t.getImageData(e.x,e.y,e.width,e.height),d=new x(n,e.x,e.y,e.width,e.height);i.undos.push(d),t.clearRect(e.x,e.y,e.width,e.height),t.putImageData(e.data,e.x,e.y),i.redos.pop(),z.disabled=!1,i.redos.length===0&&(w.disabled=!0)}function ee(e){if(o.data===void 0)return;a.style.width!==a.width*i.zoom+"px"&&(a.style.width=a.width*i.zoom+"px",a.style.height=a.height*i.zoom+"px");let t=m(e.offsetX/i.zoom)*i.zoom-o.data.width/2*i.zoom,n=m(e.offsetY/i.zoom)*i.zoom-o.data.height/2*i.zoom,d=document.body.clientWidth/2-g.scrollLeft,u=p-g.scrollTop;a.style.left=document.body.clientWidth/2-g.scrollLeft+t+"px",a.style.top=p-g.scrollTop+n+"px"}function te(e){e.stopPropagation(),e.preventDefault(),e.button===2&&(a.getContext("2d").clearRect(0,0,a.width,a.height),o.data=void 0,a.style.left="0px",a.style.top="0px",a.width="0px",a.height="0px")}function Z(e,t){o.isComplete||(r.style.width="0px",r.style.height="0px",r.style.left=e+"px",r.style.top=t+"px")}function oe(e){let t=m(e.ex-e.sx),n=m(e.ey-e.sy);r.style.width!==t+"px"&&(r.style.width=t+"px"),r.style.height!==n+"px"&&(r.style.height=n+"px"),C.innerHTML=`Width: ${t/c.tilesize} Height: ${n/c.tilesize}`}function se(){r.style.width="0px",r.style.height="0px",r.style.left="0px",r.style.top="0px"}function ie(e){if(e.ctrlKey&&e.preventDefault(),e.ctrlKey&&e.target.id==="imageCanvas"&&s.isLoaded){o.isComplete&&I(e);let t,n;if(e.wheelDelta>0){if(s.zoom===64)return;s.zoom=k(s.zoom*2,0,64),t=(e.offsetX-e.clientX/2)*2,n=(e.offsetY-(e.clientY-p)/2)*2}else if(e.wheelDelta<0){if(s.zoom<.02)return;s.zoom/=2,t=(e.offsetX-e.clientX*2)/2,n=(e.offsetY-(e.clientY-p)*2)/2}f.style.width=s.width*s.zoom+"px",f.style.height=s.height*s.zoom+"px",O.scroll(t,n),$.innerText=`Zoom: ${s.zoom}`,s.zoom>=1&&(f.style.backgroundImage=`url("/assets/grid-${s.zoom*c.tilesize/8}.png")`)}if(e.ctrlKey&&e.target.id==="tilesetCanvas"&&i.isLoaded){let t,n;if(e.wheelDelta>0){if(i.zoom===64)return;i.zoom=k(i.zoom*2,0,64),t=(e.offsetX-(e.clientX-g.offsetLeft)/2)*2,n=(e.offsetY-(e.clientY-g.offsetTop)/2)*2}else if(e.wheelDelta<0){if(i.zoom<.02)return;i.zoom/=2,t=(e.offsetX-(e.clientX-g.offsetLeft)*2)/2,n=(e.offsetY-(e.clientY-g.offsetTop)*2)/2}l.style.width=i.width*i.zoom+"px",l.style.height=i.height*i.zoom+"px",g.scroll(t,n),F.innerText=`Zoom: ${i.zoom}`,i.zoom>=1&&(l.style.backgroundImage=`url("/assets/grid-${i.zoom*c.tilesize/8}.png")`)}}function ne(e){e.ctrlKey&&e.key==="z"&&z.disabled===!1&&(e.preventDefault(),H()),e.ctrlKey&&e.key==="y"&&w.disabled===!1&&(e.preventDefault(),U()),e.ctrlKey&&e.key==="s"&&i.isLoaded&&(e.preventDefault(),S()),e.ctrlKey&&e.key==="a"&&s.isLoaded&&(e.preventDefault(),o.sx=0,o.sy=p,o.isDirty=!0,Z(o.sx,o.sy),o.ex=s.width,o.ey=s.height,o.isComplete=!0,r.style.width=s.width+"px",r.style.height=s.height+"px",E())}function ae(){o.sx=0,o.sy=0,o.ex=0,o.ey=0,o.isDirty=!1}function X(e,t,n=0,d=0){let u=e.getContext("2d");e.width=t.naturalWidth,e.height=t.naturalHeight,u.drawImage(t,n,d)}function m(e){let t=c.tilesize;return Math.round(e/t)*t}function Y(e){return e===0?!1:e%c.tilesize===0}function k(e,t,n){return Math.max(t,Math.min(e,n))}function I(e){e.stopPropagation(),e.preventDefault(),ae(),se(),o.isComplete=!1,C.innerHTML="Width: 0 Height: 0"}var x=class{constructor(t,n,d,u,L){this.data=t,this.x=n,this.y=d,this.width=u,this.height=L}};})();
//# sourceMappingURL=script.js.map
